<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bar Agent</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <style>
        /* Custom styles for the Inter font and overall layout */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            box-sizing: border-box;
        }
        .chat-container {
            background-color: #2d3748; /* Darker gray for chat background */
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 80vh; /* Set a fixed height for the chat interface */
        }
        .chat-messages {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            scroll-behavior: smooth;
        }
        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #4299e1; /* Blue for user messages */
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem; /* Slightly less rounded corner */
        }
        .agent-message {
            background-color: #a0aec0; /* Light gray for agent messages */
            color: #2d3748; /* Dark text for agent messages */
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem; /* Slightly less rounded corner */
        }
        .input-area {
            display: flex;
            padding: 1rem;
            border-top: 1px solid #4a5568; /* Border above input */
            background-color: #2d3748;
        }
        .input-area input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid #4a5568;
            background-color: #4a5568; /* Darker input background */
            color: white;
            outline: none;
        }
        .input-area button {
            margin-left: 0.75rem;
            padding: 0.75rem 1.25rem;
            background-color: #4299e1;
            color: white;
            border-radius: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .input-area button:hover {
            background-color: #3182ce;
        }
        .loading-indicator {
            text-align: center;
            padding: 1rem;
            color: #a0aec0;
            font-style: italic;
        }
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
            align-self: flex-start; /* Align options with agent message */
        }
        .option-button {
            background-color: #4a5568; /* Darker gray for buttons */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            font-size: 0.875rem; /* Smaller font for options */
        }
        .option-button:hover {
            background-color: #6a778c;
        }
        .drink-list-item {
            background-color: #4a5568;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            align-self: flex-start;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
            <!-- Initial greeting from the agent will be added by JS -->
        </div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Type your message..." class="flex-grow rounded-lg p-3 bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-blue-500">
            <button id="send-button" class="ml-3 px-5 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200">Send</button>
        </div>
    </div>

    <script>
        // The drinksData is now embedded directly into the HTML
        const drinksData = [
          {
            "id": "kahlua-milk",
            "name": "Kahlua Milk",
            "baseSpirit": "Coffee Liqueur",
            "flavorProfile": ["Sweet", "Coffee", "Creamy"],
            "ingredients": ["Kahlua", "Milk"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "None",
            "alcoholLevel": "Low",
            "abv": "5%",
            "complexity": "Very Easy",
            "notes": "A simple, sweet, and creamy coffee-flavored drink."
          },
          {
            "id": "mimosa",
            "name": "Mimosa",
            "baseSpirit": "Champagne",
            "flavorProfile": ["Sweet", "Fruity", "Citrus", "Bubbly", "Refreshing"],
            "ingredients": ["Champagne", "Orange Juice"],
            "preparationMethod": "Built",
            "glassware": "Champagne Flute",
            "garnish": "Orange Slice",
            "alcoholLevel": "Low",
            "abv": "6%",
            "complexity": "Very Easy",
            "notes": "A classic brunch cocktail, light and effervescent."
          },
          {
            "id": "dirty-shirly",
            "name": "Dirty Shirley",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Fruity", "Cherry", "Refreshing"],
            "ingredients": ["Vodka", "Grenadine", "Lemon-Lime Soda"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Maraschino Cherry",
            "alcoholLevel": "Low",
            "abv": "7%",
            "complexity": "Very Easy",
            "notes": "An adult twist on a classic soda, sweet and fun."
          },
          {
            "id": "cherry-bomb",
            "name": "Cherry Bomb",
            "baseSpirit": "Midori",
            "flavorProfile": ["Sweet", "Fruity", "Melon", "Cherry"],
            "ingredients": ["Midori", "Cherry Liqueur/Juice", "Soda/Lemon-Lime Soda"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Cherry",
            "alcoholLevel": "Medium",
            "abv": "8%",
            "complexity": "Easy",
            "notes": "A sweet and fruity drink with prominent melon and cherry notes."
          },
          {
            "id": "st-german-gin-tonic",
            "name": "St German Gin Tonic",
            "baseSpirit": "Gin",
            "flavorProfile": ["Refreshing", "Floral", "Herbal", "Bitter", "Sweet"],
            "ingredients": ["Gin", "St. Germain Elderflower Liqueur", "Tonic Water"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lemon Wedge",
            "alcoholLevel": "Medium",
            "abv": "8%",
            "complexity": "Easy",
            "notes": "A floral and refreshing twist on the classic Gin & Tonic."
          },
          {
            "id": "screwdriver",
            "name": "Screwdriver",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Citrus", "Simple", "Refreshing"],
            "ingredients": ["Vodka", "Orange Juice"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Orange Slice",
            "alcoholLevel": "Medium",
            "abv": "9%",
            "complexity": "Very Easy",
            "notes": "A straightforward and popular two-ingredient cocktail."
          },
          {
            "id": "americano",
            "name": "Americano",
            "baseSpirit": "Vermouth",
            "flavorProfile": ["Bitter", "Sweet", "Aromatic", "Herbal", "Refreshing"],
            "ingredients": ["Campari", "Sweet Vermouth", "Soda Water"],
            "preparationMethod": "Built",
            "glassware": "Old Fashioned Glass",
            "garnish": "Orange Slice",
            "alcoholLevel": "Medium",
            "abv": "9%",
            "complexity": "Easy",
            "notes": "A classic Italian aperitif, lighter than a Negroni."
          },
          {
            "id": "amaretto-stone-sour",
            "name": "Amaretto Stone Sour",
            "baseSpirit": "Amaretto",
            "flavorProfile": ["Sweet", "Sour", "Almond", "Fruity"],
            "ingredients": ["Amaretto", "Orange Juice", "Lemon Juice", "Simple Syrup"],
            "preparationMethod": "Shaken",
            "glassware": "Old Fashioned Glass",
            "garnish": "Orange Slice/Cherry",
            "alcoholLevel": "Medium",
            "abv": "9%",
            "complexity": "Medium",
            "notes": "A sweet and tangy cocktail with a distinct almond flavor."
          },
          {
            "id": "dark-and-stormy",
            "name": "Dark and Stormy",
            "baseSpirit": "Rum",
            "flavorProfile": ["Spicy", "Ginger", "Sweet", "Refreshing"],
            "ingredients": ["Dark Rum", "Ginger Beer", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium",
            "abv": "9%",
            "complexity": "Easy",
            "notes": "A zesty and spicy ginger beer cocktail with dark rum."
          },
          {
            "id": "pink-and-stormy",
            "name": "Pink and Stormy",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sweet", "Fruity", "Ginger", "Refreshing"],
            "ingredients": ["Rum", "Ginger Beer", "Cranberry Juice/Pink Grapefruit Juice", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium",
            "abv": "10%",
            "complexity": "Easy",
            "notes": "A fruity variation of the Dark 'n' Stormy with a pink hue."
          },
          {
            "id": "midori-sunrise",
            "name": "Midori Sunrise",
            "baseSpirit": "Midori",
            "flavorProfile": ["Sweet", "Fruity", "Melon", "Citrus"],
            "ingredients": ["Midori", "Orange Juice", "Grenadine"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Orange Slice/Cherry",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Easy",
            "notes": "A vibrant green and orange drink with a sweet melon flavor."
          },
          {
            "id": "cranberry-moscow-mule",
            "name": "Cranberry Moscow Mule",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Spicy", "Ginger", "Tart", "Refreshing"],
            "ingredients": ["Vodka", "Ginger Beer", "Cranberry Juice", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Copper Mug",
            "garnish": "Lime Wedge/Cranberries",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Easy",
            "notes": "A festive and tart twist on the classic Moscow Mule."
          },
          {
            "id": "raspberry-collins",
            "name": "Raspberry Collins",
            "baseSpirit": "Gin",
            "flavorProfile": ["Sweet", "Tart", "Fruity", "Refreshing", "Bubbly"],
            "ingredients": ["Gin", "Raspberry Liqueur/Muddled Raspberries", "Lemon Juice", "Simple Syrup", "Soda Water"],
            "preparationMethod": "Shaken",
            "glassware": "Collins Glass",
            "garnish": "Raspberries/Lemon Slice",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Medium",
            "notes": "A fruity and effervescent gin-based cocktail."
          },
          {
            "id": "florodora",
            "name": "Florodora",
            "baseSpirit": "Gin",
            "flavorProfile": ["Fruity", "Tart", "Sweet", "Ginger", "Refreshing"],
            "ingredients": ["Gin", "Raspberry Syrup/Liqueur", "Lime Juice", "Ginger Ale"],
            "preparationMethod": "Shaken",
            "glassware": "Highball Glass",
            "garnish": "Raspberry/Lime Wheel",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Medium",
            "notes": "A classic cocktail with gin, raspberry, lime, and ginger ale."
          },
          {
            "id": "rum-coke",
            "name": "Rum Coke",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sweet", "Cola", "Simple"],
            "ingredients": ["Rum", "Cola"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Very Easy",
            "notes": "A universally popular and easy-to-make mixed drink."
          },
          {
            "id": "tequila-sunrise",
            "name": "Tequila Sunrise",
            "baseSpirit": "Tequila",
            "flavorProfile": ["Sweet", "Fruity", "Citrus"],
            "ingredients": ["Tequila", "Orange Juice", "Grenadine"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Orange Slice/Cherry",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Easy",
            "notes": "A visually striking cocktail resembling a sunrise."
          },
          {
            "id": "palomatic-tequila",
            "name": "Palomatic Tequila",
            "baseSpirit": "Tequila",
            "flavorProfile": ["Sweet", "Sour", "Citrus", "Grapefruit", "Bubbly"],
            "ingredients": ["Tequila", "Grapefruit Soda", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge/Grapefruit Slice",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Easy",
            "notes": "A refreshing and tangy tequila-based drink, a variation of the Paloma."
          },
          {
            "id": "blue-mule",
            "name": "Blue Mule",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Citrus", "Ginger", "Refreshing"],
            "ingredients": ["Vodka", "Blue Curacao", "Ginger Beer", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Copper Mug",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Easy",
            "notes": "A colorful and zesty twist on the Moscow Mule."
          },
          {
            "id": "blue-lagoon",
            "name": "Blue Lagoon",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Citrus", "Fruity", "Refreshing"],
            "ingredients": ["Vodka", "Blue Curacao", "Lemonade"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lemon Slice/Cherry",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Easy",
            "notes": "A bright blue, sweet, and refreshing cocktail."
          },
          {
            "id": "limoncello-sunrise",
            "name": "Limoncello Sunrise",
            "baseSpirit": "Limoncello",
            "flavorProfile": ["Sweet", "Lemon", "Citrus", "Refreshing"],
            "ingredients": ["Limoncello", "Orange Juice", "Grenadine"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Orange Slice/Lemon Slice",
            "alcoholLevel": "Medium",
            "abv": "11%",
            "complexity": "Easy",
            "notes": "A sweet and tangy drink featuring the bright flavor of limoncello."
          },
          {
            "id": "blue-hawaii",
            "name": "Blue Hawaii",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sweet", "Fruity", "Tropical", "Citrus", "Refreshing"],
            "ingredients": ["White Rum", "Blue Curacao", "Pineapple Juice", "Sweet and Sour Mix"],
            "preparationMethod": "Shaken",
            "glassware": "Hurricane Glass/Poco Grande",
            "garnish": "Pineapple Wedge/Cherry",
            "alcoholLevel": "Medium",
            "abv": "12%",
            "complexity": "Medium",
            "notes": "A classic tropical cocktail with a distinctive blue color."
          },
          {
            "id": "salty-dog",
            "name": "Salty Dog",
            "baseSpirit": "Gin",
            "flavorProfile": ["Tart", "Citrus", "Salty", "Refreshing"],
            "ingredients": ["Gin", "Grapefruit Juice"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge/Grapefruit Slice",
            "alcoholLevel": "Medium",
            "abv": "12%",
            "complexity": "Easy",
            "notes": "A simple and refreshing gin-based drink with a salty rim."
          },
          {
            "id": "moscow-mule",
            "name": "Moscow Mule",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Spicy", "Ginger", "Citrus", "Refreshing"],
            "ingredients": ["Vodka", "Ginger Beer", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Copper Mug",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium",
            "abv": "12%",
            "complexity": "Easy",
            "notes": "A popular and refreshing cocktail served in a distinctive copper mug."
          },
          {
            "id": "gin-tonic",
            "name": "Gin Tonic",
            "baseSpirit": "Gin",
            "flavorProfile": ["Bitter", "Refreshing", "Herbal", "Aromatic"],
            "ingredients": ["Gin", "Tonic Water"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass/Gin Goblet",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium",
            "abv": "13%",
            "complexity": "Very Easy",
            "notes": "A timeless and simple highball cocktail."
          },
          {
            "id": "paloma",
            "name": "Paloma",
            "baseSpirit": "Tequila",
            "flavorProfile": ["Citrus", "Tart", "Sweet", "Bubbly", "Refreshing"],
            "ingredients": ["Tequila", "Grapefruit Soda", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge/Grapefruit Slice",
            "alcoholLevel": "Medium",
            "abv": "13%",
            "complexity": "Easy",
            "notes": "A popular and refreshing Mexican cocktail."
          },
          {
            "id": "elderflower-collins",
            "name": "Elderflower Collins",
            "baseSpirit": "Gin",
            "flavorProfile": ["Floral", "Sweet", "Citrus", "Refreshing", "Bubbly"],
            "ingredients": ["Gin", "Elderflower Liqueur", "Lemon Juice", "Soda Water"],
            "preparationMethod": "Shaken",
            "glassware": "Collins Glass",
            "garnish": "Lemon Slice/Edible Flower",
            "alcoholLevel": "Medium",
            "abv": "13%",
            "complexity": "Medium",
            "notes": "A light and floral gin-based cocktail, perfect for spring."
          },
          {
            "id": "amf",
            "name": "AMF",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Fruity", "Citrus", "Strong"],
            "ingredients": ["Vodka", "Rum", "Tequila", "Gin", "Blue Curacao", "Sweet and Sour Mix", "Lemon-Lime Soda"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lemon Slice/Cherry",
            "alcoholLevel": "Medium-High",
            "abv": "14%",
            "complexity": "Medium",
            "notes": "A potent and colorful long drink, often called Adios Motherfucker."
          },
          {
            "id": "french-75",
            "name": "French 75",
            "baseSpirit": "Gin",
            "flavorProfile": ["Tart", "Bubbly", "Refreshing", "Citrus"],
            "ingredients": ["Gin", "Lemon Juice", "Simple Syrup", "Champagne"],
            "preparationMethod": "Shaken",
            "glassware": "Champagne Flute",
            "garnish": "Lemon Twist",
            "alcoholLevel": "Medium-High",
            "abv": "14%",
            "complexity": "Medium",
            "notes": "A sophisticated and effervescent gin and champagne cocktail."
          },
          {
            "id": "pina-colada",
            "name": "Pina Colada",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sweet", "Tropical", "Creamy", "Fruity", "Coconut", "Pineapple"],
            "ingredients": ["White Rum", "Coconut Cream", "Pineapple Juice"],
            "preparationMethod": "Blended",
            "glassware": "Hurricane Glass/Poco Grande",
            "garnish": "Pineapple Wedge/Cherry",
            "alcoholLevel": "Medium-High",
            "abv": "15%",
            "complexity": "Medium",
            "notes": "A creamy, tropical, and sweet blended cocktail."
          },
          {
            "id": "cuba-libre-43",
            "name": "Cuba Libre 43",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sweet", "Vanilla", "Citrus", "Cola"],
            "ingredients": ["Rum", "Licor 43", "Cola", "Lime Juice"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium-High",
            "abv": "15%",
            "complexity": "Easy",
            "notes": "A variation of the Cuba Libre with the added vanilla notes of Licor 43."
          },
          {
            "id": "midori-illusion",
            "name": "Midori Illusion",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Fruity", "Melon", "Tropical"],
            "ingredients": ["Midori", "Vodka", "Cointreau/Triple Sec", "Pineapple Juice", "Lemon Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Martini Glass/Coupe",
            "garnish": "Cherry/Pineapple Leaf",
            "alcoholLevel": "Medium-High",
            "abv": "16%",
            "complexity": "Medium",
            "notes": "A vibrant green cocktail with a sweet and fruity tropical flavor."
          },
          {
            "id": "violet-squeeze",
            "name": "Violet Squeeze",
            "baseSpirit": "Gin",
            "flavorProfile": ["Floral", "Sweet", "Citrus", "Tart"],
            "ingredients": ["Gin", "Crème de Violette", "Lemon Juice", "Simple Syrup"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Lemon Twist/Edible Flower",
            "alcoholLevel": "Medium-High",
            "abv": "17%",
            "complexity": "Medium",
            "notes": "A beautiful purple cocktail with delicate floral and citrus notes."
          },
          {
            "id": "sparkling-mezcal-water",
            "name": "Sparkling Mezcal Water",
            "baseSpirit": "Mezcal",
            "flavorProfile": ["Smoky", "Earthy", "Refreshing", "Simple"],
            "ingredients": ["Mezcal", "Soda Water", "Lime Wedge"],
            "preparationMethod": "Built",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge",
            "alcoholLevel": "Medium-High",
            "abv": "17%",
            "complexity": "Very Easy",
            "notes": "A light and smoky drink, highlighting the unique flavor of mezcal."
          },
          {
            "id": "bayona",
            "name": "Bayona",
            "baseSpirit": "Champagne",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "Champagne Flute/Wine Glass",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "17%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "negroni-sour",
            "name": "Negroni Sour",
            "baseSpirit": "Gin",
            "flavorProfile": ["Bitter", "Sour", "Sweet", "Herbal", "Citrus", "Strong"],
            "ingredients": ["Gin", "Campari", "Sweet Vermouth", "Lemon Juice", "Simple Syrup", "Egg White (optional)"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Old Fashioned Glass",
            "garnish": "Orange Peel",
            "alcoholLevel": "Medium-High",
            "abv": "17%",
            "complexity": "Medium",
            "notes": "A sour variation of the classic bitter Negroni."
          },
          {
            "id": "bermuda-hundred",
            "name": "Bermuda Hundred",
            "baseSpirit": "Gin",
            "flavorProfile": ["Fruity", "Citrus", "Sweet", "Tart"],
            "ingredients": ["Gin", "Apricot Liqueur", "Lime Juice", "Grenadine"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Lime Twist",
            "alcoholLevel": "Medium-High",
            "abv": "17%",
            "complexity": "Medium",
            "notes": "A fruity and refreshing gin cocktail with apricot notes."
          },
          {
            "id": "jungle-bird",
            "name": "Jungle Bird",
            "baseSpirit": "Rum",
            "flavorProfile": ["Tropical", "Bitter", "Sweet", "Fruity"],
            "ingredients": ["Dark Rum", "Campari", "Pineapple Juice", "Lime Juice", "Simple Syrup"],
            "preparationMethod": "Shaken",
            "glassware": "Old Fashioned Glass/Collins Glass",
            "garnish": "Pineapple Wedge/Leaf",
            "alcoholLevel": "Medium-High",
            "abv": "17%",
            "complexity": "Medium",
            "notes": "A unique tropical cocktail with a bitter edge from Campari."
          },
          {
            "id": "banker-lunch",
            "name": "Banker Lunch",
            "baseSpirit": "Vodka",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "Medium-High",
            "abv": "17%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "chestnut-cup",
            "name": "Chestnut Cup",
            "baseSpirit": "Gin",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "Medium-High",
            "abv": "18%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "siesta",
            "name": "Siesta",
            "baseSpirit": "Tequila",
            "flavorProfile": ["Citrus", "Bitter", "Sweet", "Herbal", "Refreshing"],
            "ingredients": ["Tequila Blanco", "Campari", "Lime Juice", "Simple Syrup", "Grapefruit Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Cocktail Glass",
            "garnish": "Grapefruit Twist",
            "alcoholLevel": "Medium-High",
            "abv": "18%",
            "complexity": "Medium",
            "notes": "A refreshing and complex tequila cocktail with a bitter kick."
          },
          {
            "id": "devils-handle",
            "name": "Devils Handle",
            "baseSpirit": "Tequila",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "Medium-High",
            "abv": "18%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "french-blonde",
            "name": "French Blonde",
            "baseSpirit": "Gin",
            "flavorProfile": ["Floral", "Citrus", "Sweet", "Herbal"],
            "ingredients": ["Gin", "Lillet Blanc", "Elderflower Liqueur", "Grapefruit Juice", "Lemon Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Lemon Twist/Grapefruit Twist",
            "alcoholLevel": "Medium-High",
            "abv": "18%",
            "complexity": "Medium",
            "notes": "A sophisticated and aromatic cocktail with a delicate balance of flavors."
          },
          {
            "id": "risk-pool",
            "name": "Risk Pool",
            "baseSpirit": "Elderflower",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "Medium-High",
            "abv": "18%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "daiquiri",
            "name": "Daiquiri",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sour", "Sweet", "Citrus", "Refreshing"],
            "ingredients": ["White Rum", "Lime Juice", "Simple Syrup"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Lime Wheel",
            "alcoholLevel": "Medium-High",
            "abv": "20%",
            "complexity": "Easy",
            "notes": "A classic, perfectly balanced sour cocktail."
          },
          {
            "id": "pretty-in-pink",
            "name": "Pretty in Pink",
            "baseSpirit": "Elderflower",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "Medium-High",
            "abv": "20%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "passionfruit-proposal",
            "name": "Passionfruit Proposal",
            "baseSpirit": "Whiskey",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "20%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "inner-child",
            "name": "Inner Child",
            "baseSpirit": "Tequila",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "21%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "paper-plane",
            "name": "Paper Plane",
            "baseSpirit": "Whiskey",
            "flavorProfile": ["Bitter", "Sour", "Sweet", "Citrus", "Aromatic"],
            "ingredients": ["Bourbon", "Aperol", "Amaro Nonino", "Lemon Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Cocktail Glass",
            "garnish": "Lemon Twist",
            "alcoholLevel": "High",
            "abv": "21%",
            "complexity": "Medium",
            "notes": "A modern classic, perfectly balanced with bitter and sour notes."
          },
          {
            "id": "division-bell",
            "name": "Division Bell",
            "baseSpirit": "Mezcal",
            "flavorProfile": ["Smoky", "Bitter", "Citrus", "Sweet"],
            "ingredients": ["Mezcal", "Aperol", "Maraschino Liqueur", "Lime Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Cocktail Glass",
            "garnish": "Grapefruit Twist",
            "alcoholLevel": "High",
            "abv": "22%",
            "complexity": "Medium",
            "notes": "A smoky and complex cocktail with a balance of bitter and sweet."
          },
          {
            "id": "midori-sour",
            "name": "Midori Sour",
            "baseSpirit": "Midori",
            "flavorProfile": ["Sweet", "Sour", "Melon", "Fruity"],
            "ingredients": ["Midori", "Vodka (optional)", "Lemon Juice", "Simple Syrup", "Egg White (optional)"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Old Fashioned Glass",
            "garnish": "Cherry/Lemon Slice",
            "alcoholLevel": "High",
            "abv": "22%",
            "complexity": "Medium",
            "notes": "A bright green, sweet and sour cocktail with a prominent melon flavor."
          },
          {
            "id": "amaretto-sour",
            "name": "Amaretto Sour",
            "baseSpirit": "Amaretto",
            "flavorProfile": ["Sweet", "Sour", "Almond", "Citrus"],
            "ingredients": ["Amaretto", "Lemon Juice", "Simple Syrup", "Egg White (optional)"],
            "preparationMethod": "Shaken",
            "glassware": "Old Fashioned Glass",
            "garnish": "Orange Slice/Cherry",
            "alcoholLevel": "High",
            "abv": "22%",
            "complexity": "Medium",
            "notes": "A popular sweet and sour cocktail with a distinct almond flavor."
          },
          {
            "id": "blue-lady",
            "name": "Blue Lady",
            "baseSpirit": "Gin",
            "flavorProfile": ["Sweet", "Citrus", "Floral", "Refreshing"],
            "ingredients": ["Gin", "Blue Curacao", "Lemon Juice", "Egg White (optional)"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Lemon Twist",
            "alcoholLevel": "High",
            "abv": "23%",
            "complexity": "Medium",
            "notes": "A vibrant blue cocktail, a variation of the White Lady."
          },
          {
            "id": "toffee-apple",
            "name": "Toffee Apple",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Fruity", "Caramel", "Apple"],
            "ingredients": ["Vodka", "Apple Liqueur/Schnapps", "Caramel Sauce", "Apple Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Martini Glass",
            "garnish": "Apple Slice/Caramel Drizzle",
            "alcoholLevel": "High",
            "abv": "23%",
            "complexity": "Medium",
            "notes": "A sweet and dessert-like cocktail reminiscent of a toffee apple."
          },
          {
            "id": "gimlet",
            "name": "Gimlet",
            "baseSpirit": "Gin",
            "flavorProfile": ["Sour", "Citrus", "Refreshing", "Herbal"],
            "ingredients": ["Gin", "Lime Juice", "Simple Syrup"],
            "preparationMethod": "Shaken/Stirred",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Lime Wheel",
            "alcoholLevel": "High",
            "abv": "23%",
            "complexity": "Easy",
            "notes": "A classic, crisp, and tart cocktail."
          },
          {
            "id": "saving-grace",
            "name": "Saving Grace",
            "baseSpirit": "Rum",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "23%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "hurricane",
            "name": "Hurricane",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sweet", "Fruity", "Tropical", "Citrus"],
            "ingredients": ["Light Rum", "Dark Rum", "Passion Fruit Syrup", "Orange Juice", "Lime Juice", "Grenadine"],
            "preparationMethod": "Shaken",
            "glassware": "Hurricane Glass",
            "garnish": "Orange Slice/Cherry",
            "alcoholLevel": "High",
            "abv": "23%",
            "complexity": "Medium",
            "notes": "A sweet and fruity tropical cocktail, famous in New Orleans."
          },
          {
            "id": "mexican-firing-squad",
            "name": "Mexican Firing Squad",
            "baseSpirit": "Tequila",
            "flavorProfile": ["Sweet", "Sour", "Fruity", "Spicy", "Refreshing"],
            "ingredients": ["Tequila Blanco", "Grenadine", "Lime Juice", "Angostura Bitters", "Soda Water"],
            "preparationMethod": "Shaken",
            "glassware": "Highball Glass",
            "garnish": "Lime Wedge",
            "alcoholLevel": "High",
            "abv": "23%",
            "complexity": "Medium",
            "notes": "A refreshing and complex tequila cocktail with a hint of spice."
          },
          {
            "id": "left-hand",
            "name": "Left Hand",
            "baseSpirit": "Whiskey",
            "flavorProfile": ["Bitter", "Sweet", "Aromatic", "Strong"],
            "ingredients": ["Bourbon", "Sweet Vermouth", "Campari", "Chocolate Bitters"],
            "preparationMethod": "Stirred",
            "glassware": "Coupe/Old Fashioned Glass",
            "garnish": "Orange Peel",
            "alcoholLevel": "High",
            "abv": "23%",
            "complexity": "Medium",
            "notes": "A sophisticated whiskey cocktail, a variation of the Negroni."
          },
          {
            "id": "violet-sunset",
            "name": "Violet Sunset",
            "baseSpirit": "Violette",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "24%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "joy",
            "name": "Joy",
            "baseSpirit": "Mezcal",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "25%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "old-friend",
            "name": "Old Friend",
            "baseSpirit": "Elderflower",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "26%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "mai-tai",
            "name": "Mai Tai",
            "baseSpirit": "Rum",
            "flavorProfile": ["Sweet", "Fruity", "Tropical", "Nutty", "Citrus"],
            "ingredients": ["Light Rum", "Dark Rum", "Orange Curaçao", "Orgeat Syrup", "Lime Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Double Old Fashioned/Highball",
            "garnish": "Mint Sprig/Lime Wedge/Pineapple",
            "alcoholLevel": "High",
            "abv": "26%",
            "complexity": "Medium",
            "notes": "A classic tiki cocktail, complex and tropical."
          },
          {
            "id": "jasmine",
            "name": "Jasmine",
            "baseSpirit": "Gin",
            "flavorProfile": ["Floral", "Citrus", "Bitter", "Sweet"],
            "ingredients": ["Gin", "Campari", "Cointreau/Triple Sec", "Lemon Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Lemon Twist",
            "alcoholLevel": "High",
            "abv": "28%",
            "complexity": "Medium",
            "notes": "A beautifully balanced cocktail with floral notes and a bitter kick."
          },
          {
            "id": "lemon-drop",
            "name": "Lemon Drop",
            "baseSpirit": "Vodka",
            "flavorProfile": ["Sweet", "Sour", "Citrus"],
            "ingredients": ["Vodka", "Lemon Juice", "Simple Syrup"],
            "preparationMethod": "Shaken",
            "glassware": "Martini Glass",
            "garnish": "Sugar Rim/Lemon Twist",
            "alcoholLevel": "High",
            "abv": "29%",
            "complexity": "Easy",
            "notes": "A popular sweet and sour vodka cocktail."
          },
          {
            "id": "margarita",
            "name": "Margarita",
            "baseSpirit": "Tequila",
            "flavorProfile": ["Sweet", "Sour", "Citrus", "Refreshing"],
            "ingredients": ["Tequila", "Lime Juice", "Orange Liqueur"],
            "preparationMethod": "Shaken",
            "glassware": "Margarita Glass/Coupe",
            "garnish": "Lime Wedge/Salt Rim",
            "alcoholLevel": "High",
            "abv": "29%",
            "complexity": "Medium",
            "notes": "A classic and widely popular tequila cocktail."
          },
          {
            "id": "sidecar",
            "name": "Sidecar",
            "baseSpirit": "Brandy",
            "flavorProfile": ["Sour", "Sweet", "Citrus"],
            "ingredients": ["Cognac/Brandy", "Orange Liqueur", "Lemon Juice"],
            "preparationMethod": "Shaken",
            "glassware": "Coupe/Martini Glass",
            "garnish": "Orange Twist/Sugar Rim",
            "alcoholLevel": "High",
            "abv": "30%",
            "complexity": "Medium",
            "notes": "A classic sour cocktail, elegant and balanced."
          },
          {
            "id": "manhattan",
            "name": "Manhattan",
            "baseSpirit": "Whiskey",
            "flavorProfile": ["Strong", "Aromatic", "Bitter", "Sweet"],
            "ingredients": ["Rye/Bourbon Whiskey", "Sweet Vermouth", "Angostura Bitters"],
            "preparationMethod": "Stirred",
            "glassware": "Coupe/Old Fashioned Glass",
            "garnish": "Cherry",
            "alcoholLevel": "High",
            "abv": "32%",
            "complexity": "Medium",
            "notes": "A timeless and spirit-forward whiskey cocktail."
          },
          {
            "id": "tratto-limoncello",
            "name": "Tratto Limoncello",
            "baseSpirit": "Limoncello",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "32%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          },
          {
            "id": "god-father",
            "name": "God Father",
            "baseSpirit": "Whiskey",
            "flavorProfile": ["Sweet", "Almond", "Strong"],
            "ingredients": ["Scotch Whiskey", "Amaretto"],
            "preparationMethod": "Built",
            "glassware": "Old Fashioned Glass",
            "garnish": "Orange Peel (optional)",
            "alcoholLevel": "High",
            "abv": "33%",
            "complexity": "Very Easy",
            "notes": "A simple and potent two-ingredient cocktail."
          },
          {
            "id": "martini",
            "name": "Martini",
            "baseSpirit": "Gin",
            "flavorProfile": ["Strong", "Dry", "Herbal", "Aromatic"],
            "ingredients": ["Gin", "Dry Vermouth"],
            "preparationMethod": "Stirred",
            "glassware": "Martini Glass",
            "garnish": "Olive/Lemon Twist",
            "alcoholLevel": "High",
            "abv": "34%",
            "complexity": "Medium",
            "notes": "A quintessential and highly customizable cocktail."
          },
          {
            "id": "spaghetti-western",
            "name": "Spaghetti Western",
            "baseSpirit": "Mezcal",
            "flavorProfile": ["FILL_IN_THE_BLANK"],
            "ingredients": ["FILL_IN_THE_BLANK"],
            "preparationMethod": "FILL_IN_THE_BLANK",
            "glassware": "FILL_IN_THE_BLANK",
            "garnish": "FILL_IN_THE_BLANK",
            "alcoholLevel": "High",
            "abv": "40%",
            "complexity": "FILL_IN_THE_BLANK",
            "notes": "FILL_IN_THE_BLANK"
          }
        ];

        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');

        let chatHistory = []; // Stores conversation for context
        let userPreferences = {}; // Stores extracted user preferences
        let filteredDrinks = []; // Drinks that match current preferences
        let recommendedDrinksHistory = []; // IDs of drinks already recommended in pairs
        let currentRecommendationPair = []; // The two drinks currently recommended
        let conversationState = 'initial_greeting'; // State machine for conversation flow
        let questionsAskedCount = 0; // To track which question to ask next
        const MAX_RECOMMENDATION_CYCLES = 3; // Max cycles before showing full list
        const NARROW_DOWN_THRESHOLD = 10; // Number of drinks to trigger early recommendation
        let recommendationCycleCount = 0; // Current recommendation cycle

        const questions = [
            "On a scale of 1 to 10, what level of alcohol are you looking for?",
            "Do you prefer sweet, sour, spicy, bitter, herbal, refreshing, and/ or fruity drinks? (You can pick multiple!)",
            "Do you have a specific flavor in mind? (ex. strawberry, orange, grapefruit, banana, mint, ginger)",
            "Is there a drink that you liked and want to try something similar?"
        ];

        // Function to add a message to the chat interface
        function addMessage(sender, text, options = null) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            if (sender === 'user') {
                messageDiv.classList.add('user-message');
            } else {
                messageDiv.classList.add('agent-message');
            }
            messageDiv.innerHTML = text; // Use innerHTML to allow for line breaks and bolding

            chatMessages.appendChild(messageDiv);

            if (options && options.length > 0) {
                const optionsContainer = document.createElement('div');
                optionsContainer.classList.add('options-container');
                options.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option.text;
                    button.onclick = () => option.action(option.value);
                    optionsContainer.appendChild(button);
                });
                chatMessages.appendChild(optionsContainer);
            }
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to show a loading indicator
        function showLoadingIndicator() {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-indicator';
            loadingDiv.classList.add('loading-indicator');
            loadingDiv.textContent = 'Agent is thinking...';
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to remove the loading indicator
        function removeLoadingIndicator() {
            const loadingDiv = document.getElementById('loading-indicator');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        // Function to map 1-10 alcohol level to categories
        function getAlcoholLevelCategory(level) {
            if (level >= 1 && level <= 4) return "Low";
            if (level >= 5 && level <= 8) return "Medium";
            if (level >= 9 && level <= 10) return "High";
            return null; // Invalid level
        }

        // Function to filter drinks based on preferences
        function filterDrinks() {
            let tempFiltered = drinksData;

            // Filter by alcohol level
            if (userPreferences.alcoholLevel) {
                const targetCategory = getAlcoholLevelCategory(userPreferences.alcoholLevel);
                tempFiltered = tempFiltered.filter(drink => {
                    // Convert ABV string "X%" to number X for comparison
                    const abv = parseFloat(drink.abv);
                    if (isNaN(abv)) return false; // Skip if ABV is not a valid number

                    if (targetCategory === "Low") return abv <= 10; // Example: Low <= 10%
                    if (targetCategory === "Medium") return abv > 10 && abv <= 20; // Example: Medium >10% and <=20%
                    if (targetCategory === "High") return abv > 20; // Example: High > 20%
                    return true; // If category is null or not matched, don't filter
                });
            }

            // Filter by flavor profiles
            if (userPreferences.flavorPreferences && userPreferences.flavorPreferences.length > 0) {
                tempFiltered = tempFiltered.filter(drink =>
                    userPreferences.flavorPreferences.some(pref =>
                        drink.flavorProfile.map(f => f.toLowerCase()).includes(pref.toLowerCase())
                    )
                );
            }

            // Filter by specific flavors (ingredients)
            if (userPreferences.specificFlavor && userPreferences.specificFlavor.length > 0) {
                tempFiltered = tempFiltered.filter(drink =>
                    userPreferences.specificFlavor.some(pref =>
                        drink.ingredients.some(ing => ing.toLowerCase().includes(pref.toLowerCase()))
                    )
                );
            }

            // Filter by similar liked drink (base spirit and some flavor overlap)
            if (userPreferences.likedDrink && userPreferences.likedDrink.length > 0) {
                const likedDrink = drinksData.find(d => d.name.toLowerCase() === userPreferences.likedDrink.toLowerCase());
                if (likedDrink) {
                    tempFiltered = tempFiltered.filter(drink =>
                        drink.baseSpirit.toLowerCase() === likedDrink.baseSpirit.toLowerCase() ||
                        likedDrink.flavorProfile.some(pref =>
                            drink.flavorProfile.map(f => f.toLowerCase()).includes(pref.toLowerCase())
                        )
                    );
                }
            }

            filteredDrinks = tempFiltered;
        }

        // Function to select two diverse drinks from filtered list
        function selectDiverseDrinks() {
            const availableForRecommendation = filteredDrinks.filter(drink =>
                !recommendedDrinksHistory.includes(drink.id)
            );

            if (availableForRecommendation.length < 2) {
                // If not enough diverse drinks, clear history and try again or indicate no more options
                if (recommendedDrinksHistory.length > 0) {
                    recommendedDrinksHistory = []; // Reset history to allow re-recommendation
                    return selectDiverseDrinks(); // Try again with cleared history
                }
                return []; // No more unique drinks to recommend
            }

            // Simple diversity: try to pick drinks with different base spirits or primary flavor profiles
            let drink1 = availableForRecommendation[Math.floor(Math.random() * availableForRecommendation.length)];
            let drink2 = null;

            // Try to find a second drink that is "diverse" from the first
            const maxAttempts = 10;
            for (let i = 0; i < maxAttempts; i++) {
                let potentialDrink2 = availableForRecommendation[Math.floor(Math.random() * availableForRecommendation.length)];
                if (potentialDrink2.id === drink1.id) continue; // Must be different drink

                // Check for diversity (e.g., different base spirit or significantly different flavor profile)
                const isDiverse = (
                    potentialDrink2.baseSpirit !== drink1.baseSpirit ||
                    !potentialDrink2.flavorProfile.some(f => drink1.flavorProfile.includes(f))
                );

                if (isDiverse) {
                    drink2 = potentialDrink2;
                    break;
                }
            }

            // If a diverse second drink wasn't found after attempts, just pick another random one
            if (!drink2) {
                const remaining = availableForRecommendation.filter(d => d.id !== drink1.id);
                if (remaining.length > 0) {
                    drink2 = remaining[Math.floor(Math.random() * remaining.length)];
                } else {
                    return []; // Only one drink available
                }
            }

            currentRecommendationPair = [drink1, drink2];
            recommendedDrinksHistory.push(drink1.id, drink2.id); // Add to history
            return [drink1, drink2];
        }

        // Function to handle user selecting a drink
        function handleSelectDrink(drinkId) {
            const selectedDrink = drinksData.find(d => d.id === drinkId);
            if (selectedDrink) {
                addMessage('agent', `Excellent choice! Here are the details for your **${selectedDrink.name}**:
                <br>Base Spirit: ${selectedDrink.baseSpirit}
                <br>Flavor Profile: ${selectedDrink.flavorProfile.join(', ')}
                <br>Ingredients: ${selectedDrink.ingredients.join(', ')}
                <br>Alcohol Level: ${selectedDrink.alcoholLevel} (${selectedDrink.abv})
                <br>Notes: ${selectedDrink.notes || 'No specific notes.'}
                <br><br>Enjoy your drink! If you'd like to find another, just type "start over" or "change preferences".`);
                conversationState = 'finished_recommendation';
                userInput.disabled = false; // Re-enable input for new conversation
                sendButton.disabled = false;
            }
        }

        // Function to handle user preferring a drink and wanting similar ones
        async function handlePreferSimilar(drinkId) {
            const preferredDrink = drinksData.find(d => d.id === drinkId);
            if (preferredDrink) {
                addMessage('user', `I prefer the ${preferredDrink.name}, but want something similar.`);
                // Refine preferences based on the liked drink
                userPreferences.likedDrink = preferredDrink.name;
                userPreferences.baseSpirit = preferredDrink.baseSpirit; // Prioritize this base spirit
                userPreferences.flavorPreferences = [...new Set([...(userPreferences.flavorPreferences || []), ...preferredDrink.flavorProfile])]; // Add preferred drink's flavors

                filterDrinks(); // Re-filter with refined preferences

                if (filteredDrinks.length === 0) {
                    addMessage('agent', "It seems I can't find more drinks very similar to that one with your current preferences. Would you like to broaden your search or try something completely different?");
                    conversationState = 'no_match_options';
                    return;
                }

                recommendationCycleCount = 0; // Reset cycle count for similar search
                await recommendDrinks(); // Try to recommend new similar drinks
            }
        }

        // Function to handle user wanting to re-select drinks
        async function handleReselectDrinks() {
            addMessage('user', "I'm not interested in these, show me two new options.");
            recommendationCycleCount++; // Increment cycle count
            await recommendDrinks(); // Try to recommend new drinks
        }

        // Function to handle changing preferences
        function handleChangePreferences() {
            addMessage('user', "I want to change my preferences.");
            resetConversation();
            addMessage('agent', "Okay, let's start fresh. " + questions[0]);
            conversationState = 'asking_preferences';
            questionsAskedCount = 1;
            userInput.disabled = false;
            sendButton.disabled = false;
        }

        // Function to reset conversation state
        function resetConversation() {
            chatHistory = [];
            userPreferences = {};
            filteredDrinks = [];
            recommendedDrinksHistory = [];
            currentRecommendationPair = [];
            conversationState = 'initial_greeting';
            questionsAskedCount = 0;
            recommendationCycleCount = 0;
            chatMessages.innerHTML = ''; // Clear chat display
        }

        // Function to prompt the AI for the next question or recommendation
        async function askAI(prompt, responseSchema = null) {
            showLoadingIndicator();
            try {
                const apiKey = ""; // Leave empty as per instructions for gemini-2.0-flash
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: responseSchema ? "application/json" : "text/plain",
                        responseSchema: responseSchema
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    addMessage('agent', 'Oops! Something went wrong with the AI. Please try again.');
                    removeLoadingIndicator();
                    return null;
                }

                const result = await response.json();
                removeLoadingIndicator();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiResponseText = result.candidates[0].content.parts[0].text;
                    chatHistory.push({ role: 'model', parts: [{ text: aiResponseText }] });
                    return responseSchema ? JSON.parse(aiResponseText) : aiResponseText;
                } else {
                    addMessage('agent', 'I apologize, I could not generate a response. Please try again.');
                    return null;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                addMessage('agent', 'There was an issue connecting to the AI. Please check your internet connection and try again.');
                removeLoadingIndicator();
                return null;
            }
        }

        // Main function to manage conversation flow
        async function processConversation(userText = null) {
            userInput.disabled = true; // Disable input while AI is thinking
            sendButton.disabled = true;

            if (userText) {
                addMessage('user', userText);
                chatHistory.push({ role: 'user', parts: [{ text: userText }] });
                userInput.value = '';
            }

            if (conversationState === 'initial_greeting') {
                addMessage('agent', "Hello! I'm your personal bar agent. I can help you find a drink that suits your taste. " + questions[0]);
                conversationState = 'asking_preferences';
                questionsAskedCount = 1;
            } else if (conversationState === 'asking_preferences') {
                const currentQuestionIndex = questionsAskedCount - 1;
                let schema = null;
                let prompt = "";

                if (currentQuestionIndex === 0) { // Alcohol level
                    schema = {
                        type: "OBJECT",
                        properties: {
                            alcoholLevel: { type: "INTEGER", description: "User's preferred alcohol level on a scale of 1 to 10." }
                        },
                        required: ["alcoholLevel"]
                    };
                    prompt = `The user wants to find a drink. Ask them: "${questions[currentQuestionIndex]}". If they provide a number, extract it. If not, ask for a number between 1 and 10.`;
                } else if (currentQuestionIndex === 1) { // Flavor profiles
                    schema = {
                        type: "OBJECT",
                        properties: {
                            flavorPreferences: { type: "ARRAY", items: { type: "STRING", enum: ["sweet", "sour", "spicy", "bitter", "herbal", "refreshing", "fruity"] }, description: "User's preferred flavor profiles. Return an empty array if the user explicitly says no preference (e.g., 'none', 'no', 'I don't care')." }
                        }
                    };
                    prompt = `The user wants to find a drink. Ask them: "${questions[currentQuestionIndex]}". Extract their preferred flavor profiles from the list: sweet, sour, spicy, bitter, herbal, refreshing, fruity. If they indicate no preference, return an empty array for 'flavorPreferences'.`;
                } else if (currentQuestionIndex === 2) { // Specific flavors
                    schema = {
                        type: "OBJECT",
                        properties: {
                            specificFlavor: { type: "ARRAY", items: { type: "STRING" }, description: "User's specific flavor preferences (e.g., strawberry, mint, ginger). Return an empty array if the user explicitly says no preference (e.g., 'none', 'no', 'I don't care')." }
                        }
                    };
                    prompt = `The user wants to find a drink. Ask them: "${questions[currentQuestionIndex]}". Extract any specific flavor preferences they mention. If they indicate no preference, return an empty array for 'specificFlavor'.`;
                } else if (currentQuestionIndex === 3) { // Liked drink
                    schema = {
                        type: "OBJECT",
                        properties: {
                            likedDrink: { type: "STRING", description: "Name of a drink the user liked and wants something similar to. Return null if the user explicitly says no preference (e.g., 'none', 'no', 'I don't care')." }
                        }
                    };
                    prompt = `The user wants to find a drink. Ask them: "${questions[currentQuestionIndex]}". Extract the name of the drink if they mention one. If they indicate no preference, return null for 'likedDrink'.`;
                }

                const aiResponse = await askAI(prompt, schema);

                if (aiResponse) {
                    if (currentQuestionIndex === 0 && aiResponse.alcoholLevel !== undefined) {
                        userPreferences.alcoholLevel = aiResponse.alcoholLevel;
                        addMessage('agent', `Got it! You're looking for an alcohol level of ${aiResponse.alcoholLevel}.`);
                    } else if (currentQuestionIndex === 1 && aiResponse.flavorPreferences !== undefined) {
                        userPreferences.flavorPreferences = aiResponse.flavorPreferences;
                        addMessage('agent', `Okay, you prefer ${aiResponse.flavorPreferences.length > 0 ? aiResponse.flavorPreferences.join(', ') : 'no specific'} drinks.`);
                    } else if (currentQuestionIndex === 2 && aiResponse.specificFlavor !== undefined) {
                        userPreferences.specificFlavor = aiResponse.specificFlavor;
                        addMessage('agent', `Specific flavors like ${aiResponse.specificFlavor.length > 0 ? aiResponse.specificFlavor.join(', ') : 'none'} noted!`);
                    } else if (currentQuestionIndex === 3 && aiResponse.likedDrink !== undefined) {
                        userPreferences.likedDrink = aiResponse.likedDrink;
                        addMessage('agent', `So you liked ${aiResponse.likedDrink ? aiResponse.likedDrink : 'no specific drink'}. I'll keep that in mind for similar recommendations.`);
                    } else {
                        userInput.disabled = false;
                        sendButton.disabled = false;
                        return;
                    }

                    // After processing a question, filter drinks and check if we can recommend early
                    filterDrinks();
                    if (filteredDrinks.length > 0 && filteredDrinks.length <= NARROW_DOWN_THRESHOLD) {
                        addMessage('agent', `Great! I've narrowed down the options to ${filteredDrinks.length} drinks based on your preferences. Let's find you something perfect!`);
                        conversationState = 'recommending_drinks';
                        await recommendDrinks();
                    } else if (questionsAskedCount < questions.length) {
                        questionsAskedCount++;
                        addMessage('agent', questions[questionsAskedCount - 1]);
                    } else {
                        // All questions asked, proceed to recommendations
                        conversationState = 'recommending_drinks';
                        await recommendDrinks();
                    }
                }
            } else if (conversationState === 'recommending_drinks') {
                if (userText && userText.toLowerCase().includes("change preferences")) {
                    handleChangePreferences();
                } else {
                    addMessage('agent', "Please use the buttons below to make your selection, or type 'change preferences' to restart.");
                }
            } else if (conversationState === 'no_match_options') {
                 if (userText && userText.toLowerCase().includes("broaden search")) {
                    userPreferences = {}; // Clear all preferences
                    addMessage('agent', "Okay, let's broaden the search. What's most important to you now?");
                    conversationState = 'asking_preferences';
                    questionsAskedCount = 1;
                    addMessage('agent', questions[0]); // Re-ask first question
                } else if (userText && userText.toLowerCase().includes("different")) {
                    userPreferences = {}; // Clear all preferences
                    addMessage('agent', "Alright, let's try something completely different. " + questions[0]);
                    conversationState = 'asking_preferences';
                    questionsAskedCount = 1;
                } else {
                    addMessage('agent', "Please choose an option or type 'broaden search' or 'try something different'.");
                }
            } else if (conversationState === 'finished_recommendation') {
                if (userText && userText.toLowerCase().includes("start over") || userText.toLowerCase().includes("change preferences")) {
                    handleChangePreferences();
                } else {
                    addMessage('agent', "Enjoy your drink! If you'd like to find another, just type 'start over' or 'change preferences'.");
                }
            }

            userInput.disabled = false;
            sendButton.disabled = false;
        }

        // Function to recommend drinks based on filtered list
        async function recommendDrinks() {
            if (filteredDrinks.length === 0) {
                addMessage('agent', "I couldn't find any drinks matching all your preferences. Would you like to **broaden your search** or **try something completely different**?");
                conversationState = 'no_match_options';
                return;
            }

            if (recommendationCycleCount >= MAX_RECOMMENDATION_CYCLES || filteredDrinks.length - recommendedDrinksHistory.length < 2) {
                // If max cycles reached or not enough unique drinks left, show all remaining
                addMessage('agent', "Here are all the drinks that match your preferences:");
                filteredDrinks.filter(drink => !recommendedDrinksHistory.includes(drink.id)).forEach(drink => {
                    addMessage('agent', `<div class="drink-list-item">**${drink.name}** (${drink.baseSpirit}, ${drink.flavorProfile.join(', ')})</div>`);
                });
                addMessage('agent', "If you'd like to refine your search or start over, just type 'change preferences'.");
                conversationState = 'finished_recommendation';
                return;
            }

            const recommendedPair = selectDiverseDrinks();

            if (recommendedPair.length === 0) {
                addMessage('agent', "I've run out of unique recommendations based on your current preferences. Would you like to **broaden your search** or **try something completely different**?");
                conversationState = 'no_match_options';
                return;
            }

            const [drink1, drink2] = recommendedPair;

            const descriptionPrompt = `Describe these two drinks in 1-2 sentences each, focusing on their flavor profile and base spirit.
            Drink 1: ${drink1.name} (Base: ${drink1.baseSpirit}, Flavors: ${drink1.flavorProfile.join(', ')}, Notes: ${drink1.notes})
            Drink 2: ${drink2.name} (Base: ${drink2.baseSpirit}, Flavors: ${drink2.flavorProfile.join(', ')}, Notes: ${drink2.notes})
            Format the response as:
            **[Drink 1 Name]:** [Description]
            **[Drink 2 Name]:** [Description]`;

            const aiDescriptions = await askAI(descriptionPrompt);

            if (aiDescriptions) {
                addMessage('agent', `How about these two options?
                <br>${aiDescriptions}`);
                addMessage('agent', "Which one sounds good?", [
                    { text: `I'll take the ${drink1.name}!`, action: handleSelectDrink, value: drink1.id },
                    { text: `I like the ${drink1.name}, but show me similar.`, action: handlePreferSimilar, value: drink1.id },
                    { text: `I'll take the ${drink2.name}!`, action: handleSelectDrink, value: drink2.id },
                    { text: `I like the ${drink2.name}, but show me similar.`, action: handlePreferSimilar, value: drink2.id },
                    { text: `Neither, show me two new options.`, action: handleReselectDrinks, value: null },
                    { text: `Change my preferences.`, action: handleChangePreferences, value: null }
                ]);
            } else {
                addMessage('agent', "I'm having trouble describing these drinks. Let's try finding some others.");
                await handleReselectDrinks(); // Try re-selecting if description fails
            }
        }

        // Event listeners for sending messages
        sendButton.addEventListener('click', () => processConversation(userInput.value));
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                processConversation(userInput.value);
            }
        });

        // Initialize the application
        processConversation(); // Start the conversation directly as data is embedded
    </script>
</body>
</html>
